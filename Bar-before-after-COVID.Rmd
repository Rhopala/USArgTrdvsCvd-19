---
title: "Average data before/after COVID"
output: 
  flexdashboard::flex_dashboard
---

```{r setup, include=FALSE}
library(flexdashboard)
library(tidyverse)
library(dplyr)
library(plotly)
library(ggpubr)

theme_set(theme_minimal())

options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)

scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

```{r load data, include=FALSE}
import_value_df = 
  read_csv("data/cleaned data/import_value_combined.csv")

export_value_df = 
  read_csv("data/cleaned data/export_value_combined.csv")

import_volume_df = 
  read_csv("data/cleaned data/import_volume_combined.csv")

export_volume_df = 
  read_csv("data/cleaned data/export_volume_combined.csv")
```



```{r message=FALSE}
before_covid_import_value =
  import_value_df %>% 
  filter(year == "2018" | year == "2019") %>% 
  add_column("Covid_19" = "before") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(import_value)) 
  

after_covid_import_value =
  import_value_df %>% 
  filter(year == "2020" | year == "2021") %>% 
  add_column("Covid_19" = "after") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(import_value)) 

covid_import_value_df = 
  rbind(before_covid_import_value,after_covid_import_value)

before_covid_export_value =
  export_value_df %>% 
  filter(year == "2018" | year == "2019") %>% 
  add_column("Covid_19" = "before") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(export_value))

after_covid_export_value =
  export_value_df %>% 
  filter(year == "2020" | year == "2021") %>% 
  add_column("Covid_19" = "after") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(export_value)) 

covid_export_value_df = 
  rbind(before_covid_export_value,after_covid_export_value)

```


### Average Import Value Before/After Covid

```{r}
covid_import_value_plot =  
  covid_import_value_df %>%
  ggplot(aes(x = product_type, y = average, fill = Covid_19)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Average U.S. Agricultural Import Values From 2018 To 2021 ",
    x = "Product Type",
    y = "Average Import Values",
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 5),
    axis.text.y = element_text(size = 5),
    axis.title = element_text(size = 7, face = "bold"),
    legend.key.size = unit(0.5,"cm"),
    legend.text = element_text(size = 5),
    legend.title = element_text(size = 6),
    plot.title = element_text(size = 8,face = "bold")
    ) 

ggplotly(covid_import_value_plot)

```

### Average Export Value Before/After Covid

```{r}
covid_export_value_plot =  
  covid_export_value_df %>%
  ggplot(aes(x = product_type, y = average, fill = Covid_19)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Average U.S. Agricultural Export Values From 2018 To 2021 ",
    x = "Product Type",
    y = "Average Export Values",
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 5),
    axis.text.y = element_text(size = 5),
    axis.title = element_text(size = 7, face = "bold"),
    legend.key.size = unit(0.5,"cm"),
    legend.text = element_text(size = 5),
    legend.title = element_text(size = 6),
    plot.title = element_text(size = 8, face = "bold")
    )

ggplotly(covid_export_value_plot)

```



```{r message=FALSE}
before_covid_import_volume =
  import_volume_df %>%
  filter(year == "2018" | year == "2019") %>% 
  add_column("Covid_19" = "before") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(import_volume))

after_covid_import_volume =
  import_volume_df %>% 
  filter(year == "2020" | year == "2021") %>% 
  add_column("Covid_19" = "after") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(import_volume))

covid_import_volume_df = 
  rbind(before_covid_import_volume,after_covid_import_volume)

before_covid_export_volume =
  export_volume_df %>%
  filter(year == "2018" | year == "2019") %>% 
  add_column("Covid_19" = "before") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(export_volume)) 

after_covid_export_volume =
  export_volume_df %>% 
  filter(year == "2020" | year == "2021") %>% 
  add_column("Covid_19" = "after") %>% 
  group_by(product_type, Covid_19) %>% 
  summarize(average = mean(export_volume)) 

covid_export_volume_df = 
  rbind(before_covid_export_volume,after_covid_export_volume)
```

## Average Import Volume Before/After Covid
```{r}
covid_import_volume_plot =  
  covid_import_volume_df %>%
  ggplot(aes(x = product_type, y = average, fill = Covid_19)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Average U.S. Agricultural Import Volumes From 2018 To 2021 ",
    x = "Product Type",
    y = "Average Import Volumes",
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 5),
    axis.text.y = element_text(size = 5),
    axis.title = element_text(size = 7, face = "bold"),
    legend.key.size = unit(0.5,"cm"),
    legend.text = element_text(size = 5),
    legend.title = element_text(size = 6),
    plot.title = element_text(size = 8,face = "bold")
    ) 

ggplotly(covid_import_volume_plot)

```

## Average Export Volume Before/After Covid

```{r}
covid_export_volume_plot =  
  covid_export_volume_df %>%
  ggplot(aes(x = product_type, y = average, fill = Covid_19)) +
  geom_bar(stat = "identity", position = "dodge") +
  labs(
    title = "Average U.S. Agricultural Export Volumes From 2018 To 2021 ",
    x = "Product Type",
    y = "Average Export Volumes",
  ) +
  theme(
    axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1, size = 5),
    axis.text.y = element_text(size = 5),
    axis.title = element_text(size = 7, face = "bold"),
    legend.key.size = unit(0.5,"cm"),
    legend.text = element_text(size = 5),
    legend.title = element_text(size = 6),
    plot.title = element_text(size = 8, face = "bold")
    )

ggplotly(covid_export_volume_plot)
```

